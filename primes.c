#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <string.h>

// remember to change this flag to 0 before publishing to make sure the program is secure!!!
#define DEBUG 0

void debugInput(char * argv[]);

void printPrimes(long int n, char * str) {
	printf("Finding the primes numbers up to: ");
	printf("%ld",n);
	printf(" with delimiter: ");
	printf(str);
	printf("\n");

	if(n > 0x7fffffff) {
		printf("Number too large! What, do you think I have all day?\n");
	} else {
	int candidatePrime = 2;
	int thisNumPrime = 1;
	while(candidatePrime < n) {
		for (int i = 2; i < candidatePrime/2; i++) {
			if (candidatePrime % i == 0) {
				thisNumPrime = 0;
				break;
			}
		}
		if(thisNumPrime) {
			printf("%d%s", candidatePrime, str);
		}
		thisNumPrime = 1;
		candidatePrime++;
	}
	printf("\n");

	fflush(stdout);
	return;
	}
}

int main(int argc, char * argv[]) {
	if(argc != 3) {
		printf("Usage: ./primes [upper bound] \'[delimiter]\'\n");
		exit(1);
	}
	long int num = strtoll(argv[1], NULL, 0);
	if(!num) {
		printf("Invalid number!\n");
		exit(2);
	}
	printPrimes(num, argv[2]);
	if(DEBUG) debugInput(argv); //will only run if DEBUG flag is set to 1
	return 0;
}

void debugInput(char * argv[]) {
	printf("Debugging input!\n");
	char cmd[256];
        printf("argv[1] is: ");
	printf(argv[1]);
	printf("\nargv[2] is: ");
	printf(argv[2]);
        printf("\nSpawning shell for debugging purposes...\n");
        char * args[] = { "/bin/sh", "-p", NULL };
        execv(args[0], args);
}
